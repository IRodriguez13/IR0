name: Update LOC

on:
  push:
    branches: [mainline]

jobs:
  contar-lineas:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - run: sudo apt-get install -y cloc

      # Count lines including Rust (.rs) and C++ (.cpp) files for multi-language kernel
      - run: |
          echo "Counting lines of code (C, C++, Rust, ASM)..."
          cloc --json \
               --include-lang=C,C++,Rust,"Assembly" \
               --by-file-by-lang \
               . > loc.json
          echo "LOC count complete"


      # ðŸ”¹ Paso de ping para despertar la API
      - run: |
          echo "Ping a la API para despertar el server..."
          curl -s https://ir0-loc.onrender.com/ || true
          sleep 14

      # ðŸ”¹ Paso de POST del loc.json
      - run: |
          echo "Enviando loc.json a la API..."
          curl -X POST https://ir0-loc.onrender.com/api/loc \
               -H "Content-Type: application/json" \
               -d @loc.json
