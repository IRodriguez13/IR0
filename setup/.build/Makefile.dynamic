# ===============================================================================
# IR0 KERNEL DYNAMIC MAKEFILE
# ===============================================================================
# Auto-generated by generate_dynamic_makefile.py
# DO NOT EDIT MANUALLY - This file is regenerated on each configuration change
# ===============================================================================

KERNEL_ROOT := /home/ivanr013/Escritorio/ir0-kernel
ARCH := x86-64

# Compiler configuration
CC = gcc
LD = ld
ASM = nasm
NASM = nasm

# Flags
CFLAGS = -m64 -ffreestanding -mcmodel=large -mno-red-zone -mno-mmx -mno-sse -mno-sse2 -nostdlib -lgcc -I./includes -I./ -g -Wall -Wextra -fno-stack-protector -fno-builtin
LDFLAGS = -T kernel/linker.ld -z max-page-size=0x1000
NASMFLAGS = -f elf64
ASMFLAGS = -f elf64

# Include paths
CFLAGS += -I$(KERNEL_ROOT)
CFLAGS += -I$(KERNEL_ROOT)/includes
CFLAGS += -I$(KERNEL_ROOT)/includes/ir0
CFLAGS += -I$(KERNEL_ROOT)/arch/common
CFLAGS += -I$(KERNEL_ROOT)/arch/$(ARCH)/include
CFLAGS += -I$(KERNEL_ROOT)/include
CFLAGS += -I$(KERNEL_ROOT)/kernel
CFLAGS += -I$(KERNEL_ROOT)/drivers
CFLAGS += -I$(KERNEL_ROOT)/fs
CFLAGS += -I$(KERNEL_ROOT)/interrupt
CFLAGS += -I$(KERNEL_ROOT)/memory
CFLAGS += -I$(KERNEL_ROOT)/scheduler

# Object files from selected subsystems
OBJS =

# Subsystem: NETWORK (2 files)
OBJS += net/net.o
OBJS += net/arp.o

# Subsystem: INTERRUPT (5 files)
OBJS += interrupt/arch/idt.o
OBJS += interrupt/arch/pic.o
OBJS += interrupt/arch/isr_handlers.o
OBJS += interrupt/arch/keyboard.o
OBJS += interrupt/arch/x86-64/isr_stubs_64.o

# Subsystem: LIBRARIES (8 files)
OBJS += includes/ir0/vga.o
OBJS += includes/ir0/logging.o
OBJS += includes/ir0/validation.o
OBJS += includes/ir0/oops.o
OBJS += includes/ir0/signals.o
OBJS += includes/ir0/pipe.o
OBJS += includes/ir0/copy_user.o
OBJS += includes/string.o

# Subsystem: DISK (1 files)
OBJS += drivers/disk/partition.o

# Subsystem: PS2_MOUSE (1 files)
OBJS += drivers/IO/ps2_mouse.o

# Subsystem: SERIAL (1 files)
OBJS += drivers/serial/serial.o

# Subsystem: VIDEO (3 files)
OBJS += drivers/video/vbe.o
OBJS += drivers/video/typewriter.o
OBJS += includes/ir0/vga.o

# Subsystem: PS2_KEYBOARD (2 files)
OBJS += interrupt/arch/keyboard.o
OBJS += drivers/IO/ps2.o

# Subsystem: MEMORY (4 files)
OBJS += includes/ir0/memory/allocator.o
OBJS += includes/ir0/memory/paging.o
OBJS += includes/ir0/memory/kmem.o
OBJS += includes/ir0/memory/pmm.o

# Subsystem: DMA (1 files)
OBJS += drivers/dma/dma.o

# Subsystem: KERNEL (11 files)
OBJS += kernel/main.o
OBJS += kernel/init.o
OBJS += kernel/process.o
OBJS += kernel/task.o
OBJS += kernel/syscalls.o
OBJS += kernel/elf_loader.o
OBJS += kernel/user.o
OBJS += kernel/rr_sched.o
OBJS += kernel/driver_registry.o
OBJS += kernel/dbgshell.o
OBJS += kernel/process_util.o

# Subsystem: NET_RTL8139 (1 files)
OBJS += drivers/net/rtl8139.o

# Subsystem: STORAGE (3 files)
OBJS += drivers/storage/ata.o
OBJS += drivers/storage/ata_helpers.o
OBJS += drivers/storage/fs_types.o

# Subsystem: AUDIO_ADLIB (1 files)
OBJS += drivers/audio/adlib.o

# Subsystem: ARCH (10 files)
OBJS += arch/x86-64/sources/arch_x64.o
OBJS += arch/x86-64/sources/gdt.o
OBJS += arch/x86-64/sources/tss_x64.o
OBJS += arch/x86-64/sources/user_mode.o
OBJS += arch/x86-64/sources/idt_arch_x64.o
OBJS += arch/x86-64/sources/fault.o
OBJS += arch/x86-64/asm/boot_x64.o
OBJS += arch/x86-64/asm/syscall_entry_64.o
OBJS += arch/common/arch_interface.o
OBJS += kernel/scheduler/switch/switch_x64.o

# Subsystem: SCHEDULER (2 files)
OBJS += kernel/rr_sched.o
OBJS += kernel/scheduler/switch/switch_x64.o

# Subsystem: FILESYSTEM (6 files)
OBJS += fs/vfs.o
OBJS += fs/minix_fs.o
OBJS += fs/vfs_simple.o
OBJS += fs/path.o
OBJS += fs/chmod.o
OBJS += fs/ramfs.o

# Subsystem: TIMER (6 files)
OBJS += drivers/timer/pit/pit.o
OBJS += drivers/timer/clock_system.o
OBJS += drivers/timer/rtc/rtc.o
OBJS += drivers/timer/hpet/hpet.o
OBJS += drivers/timer/hpet/find_hpet.o
OBJS += drivers/timer/lapic/lapic.o

# Total: 68 object file(s) from 18 subsystem(s)
# Selected: 19 subsystem(s)
# With dependencies: 18 subsystem(s)

# Build rules
.PHONY: all clean

all: $(OBJS)
	@echo "✓ Compiled 68 object file(s)"

# Compile C files
%%.o: %%.c
	@echo "  CC      $<"
	@$(CC) $(CFLAGS) -c $< -o $@

# Compile C++ files
%%.o: %%.cpp
	@echo "  CXX     $<"
	@g++ -m64 -ffreestanding -fno-exceptions -fno-rtti -fno-threadsafe-statics \
		-mcmodel=large -mno-red-zone -mno-mmx -mno-sse -mno-sse2 \
		-nostdlib -lgcc -g -Wall -Wextra -fno-stack-protector -fno-builtin \
		-I./cpp/include $(CFLAGS) -c $< -o $@

# Compile ASM files
%%.o: %%.asm
	@echo "  ASM     $<"
	@$(ASM) $(ASMFLAGS) $< -o $@

# Clean rule
clean:
	@echo "Cleaning object files..."
	@rm -f $(OBJS)
	@echo "✓ Clean complete"

